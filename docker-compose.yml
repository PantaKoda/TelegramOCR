services:
  telegram-ocr-worker:
    build:
      context: .
      dockerfile: Dockerfile
    image: telegram-ocr-worker:latest
    command: ["python", "-m", "worker.run_forever"]
    restart: unless-stopped
    environment:
      DATABASE_URL: ${DATABASE_URL}
      WORKER_INPUT_MODE: ${WORKER_INPUT_MODE:-ocr}
      WORKER_POLL_SECONDS: ${WORKER_POLL_SECONDS:-5}
      WORKER_IDLE_LOG_EVERY: ${WORKER_IDLE_LOG_EVERY:-12}
      OCR_DEFAULT_YEAR: ${OCR_DEFAULT_YEAR:-}
      SESSION_IDLE_TIMEOUT_SECONDS: ${SESSION_IDLE_TIMEOUT_SECONDS:-25}
      OPEN_STATE: ${OPEN_STATE:-closed}
      PROCESSING_STATE: ${PROCESSING_STATE:-processing}
      DONE_STATE: ${DONE_STATE:-done}
      R2_ENDPOINT_URL: ${R2_ENDPOINT_URL:-}
      R2_ACCESS_KEY_ID: ${R2_ACCESS_KEY_ID:-}
      R2_SECRET_ACCESS_KEY: ${R2_SECRET_ACCESS_KEY:-}
      R2_BUCKET: ${R2_BUCKET:-}
      R2_REGION: ${R2_REGION:-auto}
      R2_KEY_PREFIX: ${R2_KEY_PREFIX:-}
      PADDLE_PDX_DISABLE_MODEL_SOURCE_CHECK: ${PADDLE_PDX_DISABLE_MODEL_SOURCE_CHECK:-True}
    labels:
      service: "telegram-ocr-worker"
      logging: "promtail"
    networks:
      - default
      - coolify

networks:
  coolify:
    external: true
