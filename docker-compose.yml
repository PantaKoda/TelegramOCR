services:
  telegram-ocr-worker:
    build:
      context: .
      dockerfile: Dockerfile
    image: telegram-ocr-worker:latest
    command: ["python", "-m", "worker.run_forever"]
    restart: unless-stopped
    environment:
      DATABASE_URL: ${DATABASE_URL}
      WORKER_POLL_SECONDS: ${WORKER_POLL_SECONDS:-5}
      WORKER_IDLE_LOG_EVERY: ${WORKER_IDLE_LOG_EVERY:-12}
      SESSION_IDLE_TIMEOUT_SECONDS: ${SESSION_IDLE_TIMEOUT_SECONDS:-25}
      OPEN_STATE: ${OPEN_STATE:-closed}
      PROCESSING_STATE: ${PROCESSING_STATE:-processing}
      DONE_STATE: ${DONE_STATE:-done}
      PADDLE_PDX_DISABLE_MODEL_SOURCE_CHECK: ${PADDLE_PDX_DISABLE_MODEL_SOURCE_CHECK:-True}
    labels:
      service: "telegram-ocr-worker"
      logging: "promtail"
    networks:
      - default
      - coolify

networks:
  coolify:
    external: true
